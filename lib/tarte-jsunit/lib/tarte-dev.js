tarte="undefined"==typeof tarte?{}:tarte,module="undefined"==typeof module?{}:module,module.exports=tarte;tarte.dev={};tarte.dev.unit={};tarte.dev.unit.xenv={};tarte.dev.unit.xenv.node={};tarte.dev.unit.xenv.node.Ascii=function(){"use strict";function t(){var t="";this.toString=function(){return t},this.add=function(n){return t+=n,this},this.write=function(){return process.stdout.write(t),t="",this}}return t.prototype=tarte.dev.unit.xenv.node.Ascii.prototype,new t},tarte.dev.unit.xenv.node.Ascii.prototype=new function(){"use strict";function t(t){return"["+t}this.reset=function(){return this.add(t("0m"))},this.bold=function(){return this.add(t("1m"))},this.underline=function(){return this.add(t("4m"))},this.blink=function(){return this.add(t("5m"))},this.reverse=function(){return this.add(t("7m"))},this.conceal=function(){return this.add(t("8m"))},this.fg_black=function(){return this.add(t("30m"))},this.fg_red=function(){return this.add(t("31m"))},this.fg_green=function(){return this.add(t("32m"))},this.fg_yellow=function(){return this.add(t("33m"))},this.fg_blue=function(){return this.add(t("34m"))},this.fg_magenta=function(){return this.add(t("35m"))},this.fg_cyan=function(){return this.add(t("36m"))},this.fg_white=function(){return this.add(t("37m"))},this.bg_black=function(){return this.add(t("40m"))},this.bg_red=function(){return this.add(t("41m"))},this.bg_green=function(){return this.add(t("42m"))},this.bg_yellow=function(){return this.add(t("43m"))},this.bg_blue=function(){return this.add(t("44m"))},this.bg_magenta=function(){return this.add(t("45m"))},this.bg_cyan=function(){return this.add(t("46m"))},this.bg_white=function(){return this.add(t("47m"))},this.up=function(n){return this.add(t(n+"A"))},this.down=function(n){return this.add(t(n+"B"))},this.fore=function(n){return this.add(t(n+"C"))},this.back=function(n){return this.add(t(n+"D"))},this.move=function(n,i){return this.add(t(n+";"+i+"H"))},this.clear_screen=function(){return this.add(t("2J")).move(0,0)},this.clear_line=function(){return this.add(t("K"))}};var fs=require("fs"),path=require("path"),assert=require("assert");tarte.dev.unit.xenv.node.File=new function(){"use strict";function e(e,t){var r,n,o=!1;if("filepath"in e&&"string"==typeof e.filepath)r=e.filepath,n=0;else{var a=process.argv;e:for(n=0;n<t.length;n++)for(var i=t[n].getFileName(),s=0;s<a.length;s++)if("-"!==a[s].charAt(0))try{var f=path.resolve(a[s]);if(f===i){r=i;break e}}catch(l){}null==r&&(o=!0)}var u=-1,c=!1;if(null!=r)for(;n<t.length;n++){var p=t[n];if(r!==p.getFileName())break;p.isToplevel()?(u=p.getLineNumber(),c=!0):c||(u=p.getLineNumber())}else if(o){for(n=0;n<t.length&&!t[n].isEval();n++);for(;n<t.length;n++){var h=t[n];if(!h.isEval())break;h.isToplevel()?(u=h.getLineNumber(),c=!0):c||(u=h.getLineNumber())}}return u}function t(){var r=Error.prepareStackTrace;Error.prepareStackTrace=e;var n={};Error.captureStackTrace(n,t);var o=n.stack;return Error.prepareStackTrace=r,o}function r(e,t,n,o){fs.exists(e,function(a){a?fs.stat(e,function(a){null!=a||0===t.length?o(a):(e=path.join(e,t.shift()),r(e,t,n,o))}):fs.mkdir(e,n,function(a){null!=a||0===t.length?o(a):(e=path.join(e,t.shift()),r(e,t,n,o))})})}this.load=function(e,t,r,n){function o(e){if("function"==typeof l)l(e);else if("string"==typeof l)console.error(l);else{if(null!=l)throw new TypeError(l);console.error(e)}}function a(e,t){if("function"==typeof e)null==t?e():e(u);else if("string"==typeof e)console.log(e);else if(null!=e)throw new TypeError(e)}function i(){a(r.close,u)}function s(e){u=e,l=n.close}function f(){a(r.open),l=n.read}assert.equal(typeof e,"string","@param:path must be a string."),null==t&&(t={encoding:"utf8"}),null==r&&(r={}),null==n&&(n={}),assert.equal(typeof t,"object","@param:options must be an object."),assert.equal(typeof r,"object","@param:events must be an object."),assert.equal(typeof n,"object","@param:errors must be an object.");var l,u="";l=n.open;var c=fs.createReadStream(e,t);c.on("error",o),c.on("open",f),c.on("data",s),c.on("end",i)},this.save=function(e,t,r,n,o){function a(e){if("function"==typeof u)u(e);else if("string"==typeof u)console.error(u);else{if(null!=u)throw new TypeError(u);console.error(e)}}function i(e){if("function"==typeof e)e();else if("string"==typeof e)console.log(e);else if(null!=e)throw new TypeError(e)}function s(){i(n.close)}function f(){i(n.write),u=o.close,c.end()}function l(){i(n.open),u=o.write,c.write(t)&&f()}assert.equal(typeof e,"string","@param:path must be a string."),assert.equal(typeof t,"string","@param:text must be a string."),null==r&&(r={encoding:"utf8"}),null==n&&(n={}),null==o&&(o={}),assert.equal(typeof r,"object","@param:options must be an object."),assert.equal(typeof n,"object","@param:events must be an object."),assert.equal(typeof o,"object","@param:errors must be an object.");var u;u=o.open;var c=fs.createWriteStream(e,r);c.on("error",a),c.on("open",l),c.on("drain",f),c.on("finish",s)},this.getLineNumber=t,this.mkdirs=function(e,t,n){if(void 0===n&&"function"==typeof t&&(n=t,t=null),null==n)n=function(){};else if("function"!=typeof n)throw new TypeError("@param:cb is not a function.");var o=e.split(path.sep),a=o.shift();r(a,o,t,n)}};var path=require("path");tarte.dev.unit.xenv.node.Reporter=function(e){"use strict";function n(e){function n(){p=r(h),console.log()}function r(e){var n=[e];return d(e,n),n}function d(e,n){for(var r=0;r<e.children.length;r++){var t=e.children[r];n.push(t),d(t,n)}}function t(){for(;p.length>0&&p[0].finished;){var e=p.shift();l(e)}0===p.length&&(s(),i())}function a(e){c=null;for(var n=2;n<e.length;n++){var r=e[n];if(null!=r&&"-"===r.charAt(0)){var d=r.split("=");switch(d[0]){case"--report-file":if(2!==d.length||d[1].length<1)throw new Error("!ERROR: The value of '--report-file' needs to be specified a file path.");c=d[1]}}}}function i(){null!=c&&f.mkdirs(path.dirname(c),function(e){if(e)throw e;f.save(c,JSON.stringify(o(h)))})}function o(e){for(var n=e.report(),r=[],d=0;d<e.children.length;d++)r.push(o(e.children[d]));return r.length>0&&(n.children=r),n}function l(e){for(var n=new u,r=0;r<e.depth;r++)n.add("  ");e.checkCount>0&&(e.faultCount>0?n.fg_red().add("âœ•").reset().add(" "):n.fg_green().add("âœ“").reset().add(" ")),n.add(e.description),console.log(n.toString())}function s(){for(var e=r(h),n=0,d=0,t=[],a=0;a<e.length;a++){var i=e[a];if("details"in i&&!(i.faultCount<=0)){n++,d+=i.faultCount;for(var o=0;o<i.details.length;o++){var l=i.details[o];"okng"in l&&!l.okng?t.push(l):"WARN"===l.type&&t.push(l)}}}var s=new u;if(s.add("\n  "),0===d)s.fg_green().add("All tests passed.").reset();else{s.fg_red().add(n).add(" tests (").add(d).add(" checks) errored").add("\n\n").add("== Errors ==").add("\n");for(var f=0;f<t.length;f++){var c=t[f];"WARN"===c.type?s.fg_yellow().add("line:").add(c.line).add(" - type:").add(c.type).add(", desc.:").add(null==c.description?"":c.description).add("\n").fg_red():s.add("line:").add(c.line).add(" - type:").add(c.type).add(", desc.:").add(null==c.description?"":c.description).add("\n")}s.reset()}s.add("\n"),console.log(s.toString())}this.prepare=n,this.report=t;var f=tarte.dev.unit.xenv.node.File,u=tarte.dev.unit.xenv.node.Ascii,c=null,h=e,p=[];a(process.argv)}if(null==e)throw new Error("@param:rootTree is null.");var r=new n(e);return r};tarte.dev.unit.xenv.Async=function(n,r,e,t){"use strict";function o(n){process.nextTick(n)}function i(n,r){setTimeout(n,t*r)}function f(n){if("number"!=typeof n)throw new TypeError("@param:num is not a number.");if(0===n)return void("post"in r&&o(function(){r.post()}));for(var t=[],i={},f=0;n>f;f++)t[f]=f,i[t[f]]=!0;var a=Math.min(e,n),p=t.splice(0,a),c=function(){for(var n=0;a>n;n++)u(p[n],t,i,n)};"pre"in r?r.pre.length>0?r.pre(c):(r.pre(),c()):c()}function u(r,e,t,o){s(function(){if(n.length>1)n(r,function(n){a(n,r,e,t)});else try{n(r),a(null,r,e,t)}catch(o){a(o,r,e,t)}},o)}function a(n,e,t,i){if(n&&"error"in r&&r.error(n,e),delete i[e],t.length>0){var f=t.shift();null!=f&&u(f,t,i,1)}else 0===Object.keys(i).length&&"post"in r&&o(function(){r.post()})}function p(n){if(!Array.isArray(n))throw new TypeError("@param:arr is not an Array.");if(0===n.length)return void("post"in r&&o(function(){r.post()}));for(var t=[],i={},f=0;f<n.length;f++)t[f]=f,i[t[f]]=!0;var u=Math.min(e,n.length),a=t.splice(0,u),p=function(){for(var r=0;u>r;r++)c(a[r],t,i,n,r)};"pre"in r?r.pre.length>1?r.pre(n,p):(r.pre(n),p()):p()}function c(r,e,t,o,i){s(function(){var i=o[r];if(n.length>2)n(i,r,function(n){l(n,r,e,t,o)});else try{n(i,r),l(null,r,e,t,o)}catch(f){l(f,r,e,t,o)}},i)}function l(n,e,t,i,f){if(n&&"error"in r&&r.error(n,f[e],e),delete i[e],t.length>0){var u=t.shift();null!=u&&c(u,t,i,f,1)}else 0===Object.keys(i).length&&"post"in r&&o(function(){r.post(f)})}if(null==r&&(r={}),null==e&&(e=Number.MAX_VALUE),null==t&&(t=0),"function"!=typeof n)throw new TypeError("@param:fn is not a function.");if("object"!=typeof r)throw new TypeError("@param:events is not an objext.");if("number"!=typeof e)throw new TypeError("@param:limit is not a number.");if("number"!=typeof t)throw new TypeError("@param:delay is not a number.");var s=10>t?o:i;return{times:f,each:p}};tarte.dev.unit.xenv.TreeProxy=function(t){"use strict";function e(t,n){this.parent=t,this.id=this.generateId(t),this.description=n,this.depth=null!=t?t.depth+1:1,this.finished=!1,this.children=[],this.checkCount=0,this.faultCount=0,this.hasErrors=!1,this.details=[],this.reporter=null!=t?t.reporter:new tarte.dev.unit.xenv.node.Reporter(this),this.newChild=function(t){var n=this,i=new e(n,t);return n.children.push(i),i}}return e.prototype=tarte.dev.unit.xenv.TreeProxy.prototype,new e(null,t)},tarte.dev.unit.xenv.TreeProxy.prototype=new function(){"use strict";function t(t){var e=new i(t);return e.hasNext()?e.next().line:-1}var e=tarte.dev.unit.xenv.node.File,n=0;this.generateId=function(t){return null==t?"c"+n++:t.id+"_"+t.children.length},this.report=function(){var t=this,e={id:t.id,description:t.description};return t.details.length>0&&(e.checkCount=t.checkCount,e.faultCount=t.faultCount,e.details=t.details),e},this.finish=function(){null==this.parent&&this.reporter.prepare(),this.finished=!0,this.reporter.report()},this.clear=function(){var t=this;t.finished=!1,t.checkCount=0,t.faultCount=0,t.hasErrors=!1,t.details=[]},this.note=function(t,e){this.details.push({type:t,description:e})},this.check=function(t,n,i,r,s,u){var h=this,o={type:t,description:n,okng:i,result:r,expect:s};null!=u&&(o.data=u),i||(h.faultCount++,o.line=e.getLineNumber()),h.checkCount++,h.details.push(o)},this.error=function(e){var n=this,i={type:"ERROR",description:e.stack,okng:!1};i.line=t(e.stack),n.faultCount++,n.checkCount++,this.hasErrors=!0,n.details.push(i)},this.warn=function(t){var n={type:"WARN",description:t};n.line=e.getLineNumber(),this.details.push(n)};var i=function(t){function e(){return r.length>0}function n(){var t,e=r.indexOf("\n");return 0>e?(t=r,r=""):(t=r.substring(0,e),r=r.substring(e+1)),i(t)}function i(t){var e={file:"",line:-1,col:-1};if(""===t)return e;if(t.indexOf("(eval at ")>=0){var n=t.indexOf("), "),i=t.indexOf(")",n+3),r=t.substring(n+3,i).split(":");return e.file=r[0],e.line=parseInt(r[1],10),e.col=parseInt(r[2],10),e}var s=t.indexOf("(");if(s>=0){var u=t.indexOf(")",s+1),h=t.substring(s+1,u).split(":");return e.file=h[0],e.line=parseInt(h[1],10),e.col=parseInt(h[2],10),e}var o=t.replace(/^ *at /,"").split(":");return e.file=o[0],e.line=parseInt(o[1],10),e.col=parseInt(o[2],10),e}var r=t;this.hasNext=e,this.next=n,e()&&n()}};tarte.dev.unit.TestTree=function(n){"use strict";function r(n){function t(n){if(n.checkCount>0)return!0;for(var r=0;r<n.children.length;r++)if(t(n.children[r]))return!0;return!1}function e(n){if(n.faultCount>0)return!0;for(var r=0;r<n.children.length;r++)if(e(n.children[r]))return!0;return!1}function u(n){if(n.hasErrors)return!0;for(var r=0;r<n.children.length;r++)if(u(n.children[r]))return!0;return!1}function i(n){for(var r=n.checkCount,t=0;t<n.children.length;t++)r+=i(n.children[t]);return r}function o(n){for(var r=n.faultCount,t=0;t<n.children.length;t++)r+=o(n.children[t]);return r}function c(n){n.clear();for(var r=0;r<n.children.length;r++)c(n.children[r])}function f(n){var r=[];return s(n,C,r),r}function s(n,r,t){t.push(n(r.src));for(var e=0;e<r.children.length;e++){var u=r.children[e];s(n,u,t)}}function l(n){var r=f(function(n){return n}),t=h(n),e=function(n,r,t){n.runProcess(t)};new g(e,t,5).each(r)}function h(n){var r={};return null!=n&&("error"in n&&(r.error=n.error.length>3?function(r,t,e,u){n.error(r,t,u)}:function(r,t){n.error(r,t)}),"post"in n&&(r.post=function(){n.post(C.src)}),"pre"in n&&(r.pre=n.pre.length>1?function(r,t){n.pre(C.src,t)}:function(){n.pre(C.src)})),r}function a(n){var r=v(n);if(null!=w&&"run"in w){var t=d(w.multiple,"number",1),e=d(w.delay,"number",0),u=p();new g(u,r,5,e).times(t)}else new g(function(){},r).times(1)}function p(){var n=d(w.repeat,"number",1),r=w.run.length>0?function(n,r){w.run(r)}:function(){w.run()};return function(t,e){var u,i={post:function(){e(u)},error:function(n){null==u&&(u=n),C.error(n)}};new g(r,i,1).times(n)}}function v(n){var r,t,e=function(n){null==r&&(r=n)};null!=w&&"pre"in w&&(t=w.pre.length>0?function(n){w.pre(n)}:function(){w.pre()});var u;u=null!=w&&"post"in w?w.post.length>0?function(){w.post(function(){C.finish(),n(r)})}:function(){w.post(),C.finish(),n(r)}:function(){C.finish(),n(r)};var i={};return null!=t&&(i.pre=t),null!=u&&(i.post=u),null!=e&&(i.error=e),i}function d(n,r,t){var e=typeof n;if("function"===e){var u=n();return typeof u===r?u:t}return e===r?n:t}this.id=function(){return C.id},this.description=function(){return C.description},this.parent=function(){return null==C.parent?null:C.parent.src},this.newChild=function(n){return new r(C.newChild(n))},this.note=function(n,r){C.note(n,r)},this.check=function(n,r,t,e,u,i){C.check(n,r,t,e,u,i)},this.error=function(n){C.error(n)},this.warn=function(n){C.warn(n)},this.hasChecks=function(){return t(C)},this.hasFaults=function(){return e(C)},this.hasErrors=function(){return u(C)},this.countChecks=function(){return i(C)},this.countFaults=function(){return o(C)},this.clear=function(){return c(C)},this.setProcess=function(n){w=n},this.hasProcess=function(){return null!=w},this.runProcess=a,this.runTest=l;var g=(tarte.dev.unit.TestProc,tarte.dev.unit.xenv.TreeProxy,tarte.dev.unit.xenv.Async),w=null,C=n;C.src=this}return null==n&&(n=""),new r(new tarte.dev.unit.xenv.TreeProxy(n))};tarte.dev.unit.TestProc=function(t,r){"use strict";function n(t,r,n){if(null!=t&&null!=r)for(var e in t)if(t.hasOwnProperty(e)){if(e in r){n[n.length]=e;continue}r[e]=t[e]}}function e(t,r,i){null!=t&&("commons"in t&&n(t.commons,r,i),e(t.parent(),r,i))}function i(t){this.note=function(t,n){r.note(t,n)},this.check=function(t,n,e,i,o,a){r.check(t,n,e,i,o,a)};var r=t}if(null==r||"object"!=typeof r)throw new TypeError("@param:map needs to be an object.");i.prototype=tarte.dev.unit.TestProc.prototype;var o=new i(t),a=[];n(r,o,a),e(t.parent(),o,a);for(var s=0;s<a.length;s++)t.warn("The property conflicts - "+a[s]);return t.setProcess(o),o},tarte.dev.unit.TestProc.prototype=new function(){"use strict";function t(t,r){if("string"==typeof t&&t===r)return{okng:!0,data:{same:t}};if(null==t||null==r||""===t||""===r)return{okng:!1,data:{same:"",difff1:t,diff2:r}};for(var n,e,i="",o=Math.min(t.length,r.length)+1,a=0;o>a&&(n=t.charAt(a),e=r.charAt(a),n===e);a++)i+=n;return{okng:!1,data:{same:i,diff1:n,diff2:e}}}function r(t,r,n){var e=[];if(r>=t)for(var i=t;r>=i;i+=n)e.push(i);else for(var o=t;o>=r;o-=n)e.push(o);return e[e.length-1]!==r&&e.push(r),e}function n(t,r,n){var e=[],i=t.charCodeAt(0),o=r.charCodeAt(0);if(o>=i)for(var a=i;o>=a;a+=n)e.push(String.fromCharCode(a));else for(var s=i;s>=o;s-=n)e.push(String.fromCharCode(s));return e[e.length-1]!==r&&e.push(r),e}function e(t){for(var r=[],n=0;n<t.length;n++)r.push(0);return r}function i(t,r,n){if(null==n)return[];for(var e=[],i=0;i<n.length;i++)e.push("function"==typeof r[i]?r[i].apply(t,e):r[i][n[i]]);for(var o=n.length-1;o>=0;o--)if("function"==typeof r[o]){if(0===o){n.splice(0,n.length);break}n[o]=0}else{if(!(n[o]>=r[o].length-1)){n[o]++;break}if(0===o){n.splice(0,n.length);break}n[o]=0}return e}this.message=function(t){this.note("MSG",t)},this.hbreak=function(){this.note("HBR")},this.pass=function(t){this.check("PASS",t,!0)},this.fail=function(t){this.check("FAIL",t,!1)},this.isTrue=function(t,r){this.check("TRUE",r,t===!0,t)},this.isFalse=function(t,r){this.check("FALSE",r,t===!1,t)},this.isNull=function(t,r){this.check("NULL",r,null==t,t)},this.equal=function(t,r,n){this.check("EQUAL",n,t===r,t,r)},this.match=function(r,n,e){var i=t(r,n);this.check("MATCH",e,i.okng,r,n,i.data)},this.seq=function(t,e,i){if(null==i)i=1;else{if("number"!=typeof i)throw new TypeError("@param:step is not a number.");i=Math.abs(i)}if("number"==typeof t){if("number"!=typeof e)throw new TypeError("@param:last is not a number.");return r(t,e,i)}if("string"==typeof t&&1===t.length){if("string"!=typeof e||1!==e.length)throw new TypeError("@param:last is not a character.");return n(t,e,i)}throw new TypeError("@param:start is not a number or a character.")},this.format=function(t){var r=Array.prototype.slice.call(arguments,1);return this.formatByArray(t,r)},this.formatByArray=function(t,r){function n(t){if("{0}"===t)return t;var n=r[t.slice(1,-1)-1];return"string"==typeof n?"'"+n+"'":n}null==r&&(r=[]);for(var e="",i=t.split("\\{"),o=0;o<i.length;o++)e+=i[o].replace(/\{[0-9]+\}/g,n);return e},this.matrix=function(t){if(!(arguments.length<2)){for(var r=[],n=1;n<arguments.length;n++){var o=arguments[n];if(null==o)throw new TypeError;if(Array.isArray(o))r.push(o);else{if("function"!=typeof o)throw new TypeError;r.push(o)}}for(var a=this,s=new function(){var t=e(r);this.hasNext=function(){return t.length>0},this.next=function(){return i(a,r,t)}};s.hasNext();)t.apply(this,s.next())}},this.showargs=function(){for(var t=Array.prototype.slice.call(arguments),r="",n=0;n<t.length;n++)r+=", "+this.format("{1}",t[n]);r.length>2&&(r=r.substring(2)),this.note("ARGS",r)}};tarte.dev.unit.TestScene=function(e,t){"use strict";function n(e,t){function n(e,t){var n=o.newChild(e);tarte.dev.unit.TestScene(n,t)}function c(e){null!=e&&"object"==typeof e&&(o.commons=e)}var o=e,r=new function(){this.scene=n,this.commons=c};t.call(r)}switch(typeof t){case"function":return new n(e,t);case"object":return tarte.dev.unit.TestProc(e,t);default:throw new TypeError("@param:fn needs to be either a function or an object.")}};tarte.dev.unit.TestCase=function(t,e){"use strict";return tarte.dev.unit.TestScene(t,e)};tarte.dev.unit.TestSuite=function(t,n){"use strict";function e(t,n){function e(t,n){var e=u.newChild(t);tarte.dev.unit.TestCase(e,n)}function i(t){null!=t&&"object"==typeof t&&(u.commons=t)}function o(t){u.runTest(t)}this.runTest=o;var u=t,r=new function(){this.testcase=e,this.commons=i};n.call(r)}if("function"!=typeof n)throw new TypeError("@param:fn needs to be a function.");return new e(tarte.dev.unit.TestTree(t),n)};